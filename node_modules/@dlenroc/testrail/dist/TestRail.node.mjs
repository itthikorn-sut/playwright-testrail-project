import t from"http";import e from"https";import n from"node-fetch";import r from"form-data";const i={keepAlive:!0},u=new t.Agent(i),s=new e.Agent(i),o=t=>"http:"===t.protocol?u:s,a=(t,e)=>n(t,{agent:o,...e});class h extends Error{constructor(t){super(t),this.name="TestRailException"}}async function c(t,e,n){var r;if(e&&(e.hasOwnProperty("limit")||e.hasOwnProperty("offset"))){const r=await n(e);return Array.isArray(r)?r:r[t]||[]}let i,u,s,o,a=0,h=0;const c=[],d=new Set;do{h=250*a++,i=await n({...e,limit:250,offset:h}),Array.isArray(i)?(o=!1,s=250===i.length,u=i):(o=!0,s=!!(null===(r=null==i?void 0:i._links)||void 0===r?void 0:r.next),u=i[t]||[]);for(const t of u)d.has(t.id)||(d.add(t.id),c.push(t),o=!0)}while(s&&o);return c}async function d(t,e,n,{query:i,json:u,form:s}={}){var o,c,d;const _={},C=t.baseURL+n+function(t){if(!t)return"";let e="";for(const[n,r]of Object.entries(t)){let t=r;"boolean"==typeof r?t=+r:Array.isArray(r)&&(t=r.join(",")),e+=`&${n}=${encodeURIComponent(t)}`}return e}(i);var g;let p;if(t.username&&t.password&&(_.Authorization=`Basic ${g=`${t.username}:${t.password}`,"undefined"!=typeof btoa?btoa(g):Buffer.from(g).toString("base64")}`),s||(_["Content-Type"]="application/json"),u)p=JSON.stringify(u);else if(s){p=new((null===(o=t.implementations)||void 0===o?void 0:o.FormData)||r);for(const[e,n]of Object.entries(s))n.name&&n.value?f(t,p,e,n.value,n.name):f(t,p,e,n)}for(;;){const n=await((null===(c=t.implementations)||void 0===c?void 0:c.fetch)||a)(C,{method:e,body:p,headers:_,signal:t.signal});if(429===n.status){const e=1e3*parseInt(n.headers.get("Retry-After")||"1");await l(e,t.signal);continue}if(409===n.status){await l(1e4,t.signal);continue}const r=(null===(d=n.headers.get("Content-Type"))||void 0===d?void 0:d.includes("json"))?await n.json().catch((()=>({}))):await n.blob();if(n.ok)return r;throw new h(r.error||`No additional error message received: ${n.status} ${n.statusText}`)}}function l(t,e){return(null==e?void 0:e.aborted)?Promise.reject(e.reason):new Promise(((n,r)=>{const i=setTimeout((()=>{n(),null==e||e.removeEventListener("abort",u)}),t);function u(){clearTimeout(i),r(null==e?void 0:e.reason)}null==e||e.addEventListener("abort",u,{once:!0})}))}function f(t,e,n,r,i){var u;try{e.append(n,r,i)}catch(s){const o=(null===(u=t.implementations)||void 0===u?void 0:u.Blob)||Blob,a=r instanceof o?r:new o([r]);e.append(n,a,i)}}class _{constructor(t){this.ctx={baseURL:((null==t?void 0:t.host)||"")+"/index.php?/api/v2/",...(null==t?void 0:t.user)&&{username:t.user},...(null==t?void 0:t.username)&&{username:t.username},...(null==t?void 0:t.password)&&{password:t.password},...(null==t?void 0:t.signal)&&{signal:t.signal},...(null==t?void 0:t.implementations)&&{implementations:t.implementations}}}addAttachmentToCase(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_attachment_to_case/${e}`,{form:{attachment:n}})}(n,t,e)))}addAttachmentToPlan(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_attachment_to_plan/${e}`,{form:{attachment:n}})}(n,t,e)))}addAttachmentToPlanEntry(t,e,n,r){return this.withCtx(r,(r=>function(t,e,n,r){return d(t,"POST",`add_attachment_to_plan_entry/${e}/${n}`,{form:{attachment:r}})}(r,t,e,n)))}addAttachmentToResult(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_attachment_to_result/${e}`,{form:{attachment:n}})}(n,t,e)))}addAttachmentToRun(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_attachment_to_run/${e}`,{form:{attachment:n}})}(n,t,e)))}getAttachmentsForCase(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("attachments",n,(n=>d(t,"GET",`get_attachments_for_case/${e}`,{query:n})))}(n,t,e)))}getAttachmentsForPlan(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("attachments",n,(n=>d(t,"GET",`get_attachments_for_plan/${e}`,{query:n})))}(n,t,e)))}getAttachmentsForPlanEntry(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"GET",`get_attachments_for_plan_entry/${e}/${n}`)}(n,t,e)))}getAttachmentsForRun(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("attachments",n,(n=>d(t,"GET",`get_attachments_for_run/${e}`,{query:n})))}(n,t,e)))}getAttachmentsForTest(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_attachments_for_test/${e}`)}(e,t)))}getAttachment(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_attachment/${e}`)}(e,t)))}deleteAttachment(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_attachment/${e}`)}(e,t)))}getBdd(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_bdd/${e}`)}(e,t)))}addBdd(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_bdd/${e}`,{form:{attachment:n}})}(n,t,e)))}getCase(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_case/${e}`)}(e,t)))}getCases(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("cases",n,(n=>d(t,"GET",`get_cases/${e}`,{query:n})))}(n,t,e)))}getHistoryForCase(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("history",n,(n=>d(t,"GET",`get_history_for_case/${e}`,{query:n})))}(n,t,e)))}addCase(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_case/${e}`,{json:n})}(n,t,e)))}copyCasesToSection(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`copy_cases_to_section/${e}`,{json:n})}(n,t,e)))}updateCase(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_case/${e}`,{json:n})}(n,t,e)))}updateCases(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_cases/${e}`,{json:n})}(n,t,e)))}moveCasesToSection(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`move_cases_to_section/${e}`,{json:n})}(n,t,e)))}deleteCase(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_case/${e}`)}(e,t)))}deleteCases(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`delete_cases/${e}`,{json:n})}(n,t,e)))}getCaseFields(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_case_fields")}(t)))}addCaseField(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST","add_case_field",{json:e})}(e,t)))}getCaseTypes(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_case_types")}(t)))}getConfigs(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_configs/${e}`)}(e,t)))}addConfigGroup(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_config_group/${e}`,{json:n})}(n,t,e)))}addConfig(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_config/${e}`,{json:n})}(n,t,e)))}updateConfigGroup(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_config_group/${e}`,{json:n})}(n,t,e)))}updateConfig(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_config/${e}`,{json:n})}(n,t,e)))}deleteConfigGroup(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_config_group/${e}`)}(e,t)))}deleteConfig(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_config/${e}`)}(e,t)))}getDataset(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_dataset/${e}`)}(e,t)))}getDatasets(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("datasets",n,(n=>d(t,"GET",`get_datasets/${e}`,{query:n})))}(n,t,e)))}addDataset(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_dataset/${e}`,{json:n})}(n,t,e)))}updateDataset(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_dataset/${e}`,{json:n})}(n,t,e)))}deleteDataset(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_dataset/${e}`)}(e,t)))}getGroup(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_group/${e}`)}(e,t)))}getGroups(t,e){return this.withCtx(e,(e=>function(t,e){return c("groups",e,(e=>d(t,"GET","get_groups",{query:e})))}(e,t)))}addGroup(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST","add_group",{json:e})}(e,t)))}updateGroup(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_group/${e}`,{json:n})}(n,t,e)))}deleteGroup(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_group/${e}`)}(e,t)))}getMilestone(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_milestone/${e}`)}(e,t)))}getMilestones(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("milestones",n,(n=>d(t,"GET",`get_milestones/${e}`,{query:n})))}(n,t,e)))}addMilestone(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_milestone/${e}`,{json:n})}(n,t,e)))}updateMilestone(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_milestone/${e}`,{json:n})}(n,t,e)))}deleteMilestone(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_milestone/${e}`)}(e,t)))}getPlan(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_plan/${e}`)}(e,t)))}getPlans(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("plans",n,(n=>d(t,"GET",`get_plans/${e}`,{query:n})))}(n,t,e)))}addPlan(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_plan/${e}`,{json:n})}(n,t,e)))}addPlanEntry(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_plan_entry/${e}`,{json:n})}(n,t,e)))}addRunToPlanEntry(t,e,n,r){return this.withCtx(r,(r=>function(t,e,n,r){return d(t,"POST",`add_run_to_plan_entry/${e}/${n}`,{json:r})}(r,t,e,n)))}updatePlan(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_plan/${e}`,{json:n})}(n,t,e)))}updatePlanEntry(t,e,n,r){return this.withCtx(r,(r=>function(t,e,n,r){return d(t,"POST",`update_plan_entry/${e}/${n}`,{json:r})}(r,t,e,n)))}updateRunInPlanEntry(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_run_in_plan_entry/${e}`,{json:n})}(n,t,e)))}closePlan(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`close_plan/${e}`)}(e,t)))}deletePlan(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_plan/${e}`)}(e,t)))}deletePlanEntry(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`delete_plan_entry/${e}/${n}`)}(n,t,e)))}deleteRunFromPlanEntry(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_run_from_plan_entry/${e}`)}(e,t)))}getPriorities(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_priorities")}(t)))}getProject(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_project/${e}`)}(e,t)))}getProjects(t,e){return this.withCtx(e,(e=>function(t,e){return c("projects",e,(e=>d(t,"GET","get_projects",{query:e})))}(e,t)))}addProject(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST","add_project",{json:e})}(e,t)))}updateProject(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_project/${e}`,{json:n})}(n,t,e)))}deleteProject(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_project/${e}`)}(e,t)))}getReports(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_reports/${e}`)}(e,t)))}runReport(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`run_report/${e}`)}(e,t)))}getResults(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("results",n,(n=>d(t,"GET",`get_results/${e}`,{query:n})))}(n,t,e)))}getResultsForCase(t,e,n,r){return this.withCtx(r,(r=>function(t,e,n,r){return c("results",r,(r=>d(t,"GET",`get_results_for_case/${e}/${n}`,{query:r})))}(r,t,e,n)))}getResultsForRun(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("results",n,(n=>d(t,"GET",`get_results_for_run/${e}`,{query:n})))}(n,t,e)))}addResult(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_result/${e}`,{json:n})}(n,t,e)))}addResultForCase(t,e,n,r){return this.withCtx(r,(r=>function(t,e,n,r){return d(t,"POST",`add_result_for_case/${e}/${n}`,{json:r})}(r,t,e,n)))}addResults(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_results/${e}`,{json:n})}(n,t,e)))}addResultsForCases(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_results_for_cases/${e}`,{json:n})}(n,t,e)))}getResultFields(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_result_fields")}(t)))}getRoles(t,e){return this.withCtx(e,(e=>function(t,e){return c("roles",e,(e=>d(t,"GET","get_roles",{query:e})))}(e,t)))}getRun(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_run/${e}`)}(e,t)))}getRuns(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("runs",n,(n=>d(t,"GET",`get_runs/${e}`,{query:n})))}(n,t,e)))}addRun(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_run/${e}`,{json:n})}(n,t,e)))}updateRun(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_run/${e}`,{json:n})}(n,t,e)))}closeRun(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`close_run/${e}`)}(e,t)))}deleteRun(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_run/${e}`)}(e,t)))}getSection(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_section/${e}`)}(e,t)))}getSections(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("sections",n,(n=>d(t,"GET",`get_sections/${e}`,{query:n})))}(n,t,e)))}addSection(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_section/${e}`,{json:n})}(n,t,e)))}moveSection(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`move_section/${e}`,{json:n})}(n,t,e)))}updateSection(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_section/${e}`,{json:n})}(n,t,e)))}deleteSection(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_section/${e}`)}(e,t)))}getSharedStep(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_shared_step/${e}`)}(e,t)))}getSharedSteps(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("shared_steps",n,(n=>d(t,"GET",`get_shared_steps/${e}`,{query:n})))}(n,t,e)))}getSharedStepHistory(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("step_history",n,(n=>d(t,"GET",`get_shared_step_history/${e}`,{query:n})))}(n,t,e)))}addSharedStep(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_shared_step/${e}`,{json:n})}(n,t,e)))}updateSharedStep(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_shared_step/${e}`,{json:n})}(n,t,e)))}deleteSharedStep(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`delete_shared_step/${e}`,{json:n})}(n,t,e)))}getStatuses(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_statuses")}(t)))}getCaseStatuses(t,e){return this.withCtx(e,(e=>function(t,e){return c("case_statuses",e,(e=>d(t,"GET","get_case_statuses",{query:e})))}(e,t)))}getSuite(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_suite/${e}`)}(e,t)))}getSuites(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_suites/${e}`)}(e,t)))}addSuite(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_suite/${e}`,{json:n})}(n,t,e)))}updateSuite(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_suite/${e}`,{json:n})}(n,t,e)))}deleteSuite(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_suite/${e}`)}(e,t)))}getTemplates(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_templates/${e}`)}(e,t)))}getTest(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_test/${e}`)}(e,t)))}getTests(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("tests",n,(n=>d(t,"GET",`get_tests/${e}`,{query:n})))}(n,t,e)))}getUser(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET",`get_user/${e}`)}(e,t)))}getCurrentUser(t){return this.withCtx(t,(t=>function(t){return d(t,"GET","get_current_user")}(t)))}getUserByEmail(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET","get_user_by_email",{query:{email:e}})}(e,t)))}getUsers(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"GET","get_users",{query:e})}(e,t)))}addUser(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST","add_user",{json:e})}(e,t)))}updateUser(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_user/${e}`,{json:n})}(n,t,e)))}getVariables(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return c("variables",n,(n=>d(t,"GET",`get_variables/${e}`,{query:n})))}(n,t,e)))}addVariable(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`add_variable/${e}`,{json:n})}(n,t,e)))}updateVariable(t,e,n){return this.withCtx(n,(n=>function(t,e,n){return d(t,"POST",`update_variable/${e}`,{json:n})}(n,t,e)))}deleteVariable(t,e){return this.withCtx(e,(e=>function(t,e){return d(t,"POST",`delete_variable/${e}`)}(e,t)))}withCtx(t,e){var n;const r=this.ctx.signal,i=null==t?void 0:t.signal;if(!i)return e(this.ctx);if(!r)return e(Object.assign({},this.ctx,{signal:t.signal}));if(r.aborted||i.aborted)return Promise.reject(r.reason||t.signal.reason);const u=new((null===(n=this.ctx.implementations)||void 0===n?void 0:n.AbortController)||AbortController),s=()=>{r.removeEventListener("abort",o),i.removeEventListener("abort",o)},o=()=>{s(),u.abort(r.reason||i.reason)};return r.addEventListener("abort",o),i.addEventListener("abort",o),e(Object.assign({},this.ctx,{signal:u.signal})).then((t=>(s(),t)),(t=>{throw s(),t}))}}_.Exception=h;export{_ as default};
//# sourceMappingURL=TestRail.node.mjs.map
